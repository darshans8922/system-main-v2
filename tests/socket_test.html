<!DOCTYPE html>
<html>
<head>
    <title>Socket.IO Code Listener Test</title>
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
</head>
<body>
    <h1>Socket.IO Code Listener Test</h1>
    <div id="status">Connecting...</div>
    <div id="messages"></div>

    <script>
        const socket = io('http://localhost:5000/events', { 
            query: { username: 'bharat' },
            transports: ['polling', 'websocket']
        });
        const statusEl = document.getElementById('status');
        const messagesEl = document.getElementById('messages');

        socket.on('connect', () => {
            console.log('âœ… Connected to /events');
            statusEl.textContent = 'âœ… Connected';
            statusEl.style.color = 'green';
            socket.emit('subscribe');
        });

        socket.on('subscribed', (data) => {
            console.log('âœ… Subscribed:', data);
            statusEl.textContent = 'âœ… Connected & Subscribed';
        });

        socket.on('new_code', (data) => {
            console.log('ğŸ“¨ Received:', data);
            const msg = document.createElement('div');
            msg.style.padding = '10px';
            msg.style.margin = '5px';
            msg.style.border = '1px solid #ccc';
            msg.style.borderRadius = '4px';
            msg.innerHTML = `<strong>Code:</strong> ${data.code}<br><strong>Source:</strong> ${data.source}<br><strong>Username:</strong> ${data.username}<br><strong>Timestamp:</strong> ${data.timestamp}`;
            messagesEl.insertBefore(msg, messagesEl.firstChild);
        });

        socket.on('error', (err) => {
            console.error('âŒ Error:', err);
            statusEl.textContent = 'âŒ Error: ' + (err.message || JSON.stringify(err));
            statusEl.style.color = 'red';
        });

        socket.on('disconnect', () => {
            console.log('âŒ Disconnected');
            statusEl.textContent = 'âŒ Disconnected';
            statusEl.style.color = 'red';
        });
    </script>
</body>
</html>

